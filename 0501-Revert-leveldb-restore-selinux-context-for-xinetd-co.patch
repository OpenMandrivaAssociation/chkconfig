--- chkconfig-1.7/leveldb.c.orig	2015-12-17 17:55:26.415218260 +0200
+++ chkconfig-1.7/leveldb.c	2015-12-17 18:01:21.602240543 +0200
@@ -27,9 +27,6 @@
 #include <stdio.h>
 #include <string.h>
 #include <unistd.h>
-#include <selinux/selinux.h>
-#include <selinux/label.h>
-#include <libgen.h>
 
 /* Changes
    1998-09-22 - Arnaldo Carvalho de Melo <acme@conectiva.com.br>
@@ -41,47 +38,6 @@
 
 #include "leveldb.h"
 
-int selinux_restore(const char *name) {
-        struct selabel_handle *hnd = NULL;
-        struct stat buf;
-        security_context_t newcon = NULL;
-        int r = -1;
-
-        hnd = selabel_open(SELABEL_CTX_FILE, NULL, 0);
-        if (hnd == NULL)
-                goto out;
-
-        r = stat(name, &buf);
-        if (r < 0)
-                goto out;
-
-        r = selabel_lookup_raw(hnd, &newcon, name, buf.st_mode);
-        if (r < 0)
-                goto out;
-
-        r = setfilecon_raw(name, newcon);
-        if (r < 0)
-                goto out;
-
-        r = 0;
-
- out:
-        if (hnd)
-                selabel_close(hnd);
-        if (newcon)
-                freecon(newcon);
-
-        /* Lets ignore any errors when selinux is disabled.
-         * We still want to run the previous code though,
-         * since we only need selinux policy.
-         * Selinux itself can be turned off.
-         */
-        if (!is_selinux_enabled())
-                 return 0;
-
-        return r;
-}
-
 int parseLevels(char * str, int emptyOk) {
     char * chptr = str;
     int rc = 0;
@@ -779,7 +744,6 @@
 	char *buf, *ptr, *tmp;
 	struct stat sb;
         mode_t mode;
-        int r;
 
 	if (on == -1) {
 		on = s.enabled ? 1 : 0;
@@ -826,11 +790,7 @@
 	}
 	close(newfd);
 	unlink(oldfname);
-        r = rename(newfname,oldfname);
-        if (selinux_restore(oldfname) != 0)
-                fprintf(stderr, _("Unable to set selinux context for %s: %s\n"), oldfname,
-		strerror(errno));
-	return(r);
+	return(rename(newfname,oldfname));
 }
 
 int doSetService(struct service s, int level, int on) {
@@ -862,12 +822,11 @@
 
 int systemdIsInit() {
     char *path = realpath("/sbin/init", NULL);
-    char *base = NULL;
+    char *base;
 
     if (!path)
         return 0;
     base = basename(path);
-    puts(base);
     if (!base)
         return 0;
     if (strcmp(base,"systemd"))
@@ -1259,10 +1218,10 @@
                         }
                 }
         }
-
-
+        
+       
 finish:
-
+                
         if(star) {
                 for (i = 0; i < n_star; i++)
                         free(star[i]);
